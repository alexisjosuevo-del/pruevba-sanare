<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cotizaci贸n - Sanare</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
</head>
<body>

<!--  LOGIN OVERLAY INTEGRADO POR GPT -->
<div id="overlay" style="position:fixed;inset:0;background:#0a497b80;display:flex;justify-content:center;align-items:center;z-index:9999;">
  <div style="background:white;padding:25px;border-radius:12px;box-shadow:0 0 15px rgba(0,0,0,0.2);width:320px;text-align:center;">
    <img src="SANARE_logo.png" alt="Sanare" style="width:100px;margin-bottom:10px;">
    <h2 style="color:#0A497B;">Acceso Sanare</h2>
    <input id="user" placeholder="Usuario" style="width:100%;margin:5px 0;padding:8px;" />
    <input id="pass" type="password" placeholder="Contrase帽a" style="width:100%;margin:5px 0;padding:8px;" />
    <button onclick="checkLogin()" style="background:#0A497B;color:white;border:none;padding:10px 20px;margin-top:10px;border-radius:8px;cursor:pointer;">
      Entrar
    </button>
  </div>
</div>

<script>
  const USERS = {
    "admin": "g84k$2H*9Xl!",
    "nomad": "cFs1kt$1TleN",
    "vendedor": "juvkSxrq?2@2",
    "kam1": "fdSB%P174bnz",
    "kam2": "ZLjBocRHxL@U"
  };

  function checkLogin() {
    const u = document.getElementById("user").value.trim();
    const p = document.getElementById("pass").value.trim();
    if (USERS[u] && USERS[u] === p) {
      document.getElementById("overlay").style.display = "none";
    } else {
      alert("Usuario o contrase帽a incorrectos");
    }
  }

  // Siempre pide login al cargar (sin guardar sesi贸n)
  window.addEventListener("load", () => {
    document.getElementById("overlay").style.display = "flex";
  });
</script>
<!--  FIN LOGIN OVERLAY -->


  <main id="cotizador">
    <header class="header">
      <img src="SANARE_logo.png" alt="Sanare" class="logo" />
      <div class="empresa">
        <h1>Cotizaci贸n</h1>
        <label>Direcci贸n de la empresa</label>
        <select id="direccion"></select>
<div id="telefono" style="margin-top:5px; font-weight:bold;"></div>

        <div class="tel">Tel茅fono:</div>
      </div>
      <div class="extras">
        <label>Fecha de emisi贸n</label>
        <input type="date" id="fechaEmision" />
        <label>Presupuesto v谩lido hasta</label>
        <input type="date" id="fechaValidez" />
        <label>Realizado por</label>
        <input type="text" id="realizadoPor" placeholder="Corporativo" />
      </div>
    </header>

    <section class="datos">
      <div>
        <label>Nombre del paciente</label>
        <input id="paciente" placeholder="Nombre del paciente" />
      </div>
      <div>
        <label>Nombre del m茅dico</label>
        <input id="medico" placeholder="Nombre del m茅dico" />
      </div>
      <div>
        <label>Aseguradora</label>
        <input id="aseguradora" placeholder="Pago de bolsillo" />
      </div>
      <div class="full">
        <label>DX / Comentarios</label>
        <textarea id="dx" rows="2" placeholder="Diagn贸stico / comentarios"></textarea>
      </div>
      <div>
        <label>Esquema o tratamiento</label>
        <input id="esquema" placeholder="Ej. OXALIPLATINO" />
      </div>
      <div>
        <label>KAM</label>
        <input id="kam" placeholder="Corporativo / Nombre" />
      </div>
      <div>
        <label>Fecha de programaci贸n</label>
        <input type="date" id="fecha" />
      </div>
    </section>

    <section>
      <h2>Medicamentos</h2>
      <div class="fila">
        <input type="text" id="buscarMed" placeholder="Buscar medicamento o c贸digo..." />
        <select id="ordenMed">
          <option value="nombre">Ordenar por: AZ</option>
          <option value="precio">Ordenar por: Precio (desc)</option>
        </select>
      </div>
      <div class="fila">
        <select id="selMedicamento"></select>
        <input type="number" id="cantMed" min="1" value="1" />
        <button id="addMed">Agregar medicamento</button>
      </div>
      <table id="tablaMedicamentos">
        <thead>
          <tr><th>Medicamento</th><th>C贸digo</th><th>Cantidad</th><th>P. unitario</th><th>Subtotal</th><th></th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section>
      <h2>Servicios</h2>
      <div class="fila">
        <select id="selServicio">
        <!-- honorario manual -->
        <input type="number" id="honorarioInput" placeholder="Monto honorario" style="display:none; width:120px; padding:5px; font-size:13px;"></select>
        <input type="number" id="cantServ" min="1" value="1" />
        <label>Descuento (%)</label>
        <input type="number" id="descServ" min="0" max="100" value="0" />
        <button id="addServ">Agregar servicio</button>
      </div>
      <table id="tablaServicios">
        <thead>
          <tr><th>Servicio</th><th>Cantidad</th><th>P. unitario</th><th>Descuento (%)</th><th>Total c/desc.</th><th></th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section class="totales">
      <div class="grid">
        <div><span>Subtotal</span><strong id="subtotal">$ 0.00</strong></div>
        <div><span>IVA sobre Servicios (16%)</span><strong id="iva">$ 0.00</strong></div>
        <div class="total"><span>TOTAL</span><strong id="total">$ 0.00</strong></div>
      </div>
      
<p class="disclaimer">
  La presente cotizaci贸n es v谩lida por 15 d铆as e incluye 煤nicamente los conceptos se帽alados; 
  cualquier servicio adicional ser谩 cotizado aparte; el pago deber谩 realizarse al momento del ingreso, 
  pacientes de aseguradora debe presentarse con su carta de autorizaci贸n vigente; 
  En caso de cancelaci贸n el paciente deber谩 avisar con al menos 24 horas de anticipaci贸n, 
  de lo contrario se cobrar谩 el medicamento y los servicios asociados al medicamento; 
  La presente cotizaci贸n est谩 sujeta a cambios si el m茅dico tratante as铆 lo indica.
</p>
<button id="btnPDF">Descargar PDF</button>
    </section>
  </main>

  <script src="app.js"></script>

  <!-- Librer铆as para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
  document.addEventListener("DOMContentLoaded", function() {
    const btn = document.getElementById("btnPDF");
    if (!btn) return;

    btn.addEventListener("click", function() {
      const { jsPDF } = window.jspdf;
      html2canvas(document.getElementById("cotizador"), { 
        scale: 2, 
        useCORS: true,
        onclone: (clonedDoc) => {
          clonedDoc.querySelectorAll(
            '#buscarMed, #ordenMed, #selMedicamento, #cantMed, #selServicio, #cantServ, #descServ, #addMed, #addServ, .btn-eliminar, #btnPDF, table button'
          ).forEach(el => el.style.display = 'none');
        }
      }).then(function(canvas) {
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jsPDF("p", "mm", "a4");
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        let imgWidth = pageWidth;
        let imgHeight = (canvas.height * imgWidth) / canvas.width;
        if (imgHeight > pageHeight) {
          const ratio = pageHeight / imgHeight;
          imgWidth *= ratio;
          imgHeight *= ratio;
        }

        const x = (pageWidth - imgWidth) / 2;
        pdf.addImage(imgData, "PNG", x, 0, imgWidth, imgHeight);

        // Datos din谩micos
        let paciente = document.getElementById("paciente").value || "Paciente";
        let fecha = document.getElementById("fechaEmision").value || new Date().toISOString().split("T")[0];

        paciente = paciente.replace(/[^a-z0-9]/gi, "_");
        fecha = fecha.replace(/[^0-9\-]/g, "_");

        let nombreArchivo = `Sanare_${paciente}_${fecha}.pdf`;
        pdf.save(nombreArchivo);
      });
    });
  });
  </script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  var direccion = document.getElementById("direccion");
  var telefono = document.getElementById("telefono");
  if(direccion){
    direccion.addEventListener("change", function() {
      if(this.value === "Toluca"){
        telefono.textContent = "Tel: 722 197 08 36";
      } else if(this.value === "Narvarte"){
        telefono.textContent = "Tel: 55 5255 8403";
      } else {
        telefono.textContent = "";
      }
    });
  }
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function() {
  var direccion = document.getElementById("direccion");
  var telefono = document.getElementById("telefono");
  if(direccion && telefono){
    function actualizarTelefono() {
      var val = direccion.value;
      if(val.includes("Toluca")){
        telefono.textContent = "722 197 08 36";
      } else if(val.includes("Narvarte")){
        telefono.textContent = "55 5255 8403";
      } else {
        telefono.textContent = "";
      }
    }
    direccion.addEventListener("change", actualizarTelefono);
    actualizarTelefono(); // Ejecutar al cargar
  }
});
</script>

</body>
</html>


  
